{% extends "base.html" %}

{% block title %}LLM Leaderboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-trophy text-warning"></i> LLM Leaderboard</h1>
            <div>
                <a href="{{ url_for('settings') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-cog"></i> Customize Columns
                </a>
            </div>
        </div>
        
        <!-- Filter Controls -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-filter"></i> Filters</h5>
            </div>
            <div class="card-body">
                <form method="GET" class="row g-3">
                    {% if 'provider' in enabled_filters %}
                    <!-- Provider Filter -->
                    <div class="col-md-3">
                        <label for="provider" class="form-label">Provider</label>
                        <select name="provider" id="provider" class="form-select">
                            <option value="">All Providers</option>
                            {% for provider in providers %}
                                <option value="{{ provider }}" {% if current_filters.provider == provider %}selected{% endif %}>
                                    {{ provider }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'open_source' in enabled_filters %}
                    <!-- Open Source Filter -->
                    <div class="col-md-2">
                        <label for="open_source" class="form-label">Open Source</label>
                        <select name="open_source" id="open_source" class="form-select">
                            <option value="">All</option>
                            <option value="true" {% if current_filters.open_source == true %}selected{% endif %}>Yes</option>
                            <option value="false" {% if current_filters.open_source == false %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'reasoning' in enabled_filters %}
                    <!-- Reasoning Filter -->
                    <div class="col-md-2">
                        <label for="reasoning" class="form-label">Reasoning</label>
                        <select name="reasoning" id="reasoning" class="form-select">
                            <option value="">All</option>
                            <option value="true" {% if current_filters.reasoning == true %}selected{% endif %}>Yes</option>
                            <option value="false" {% if current_filters.reasoning == false %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'image_input' in enabled_filters %}
                    <!-- Image Input Filter -->
                    <div class="col-md-2">
                        <label for="image_input" class="form-label">Image Input</label>
                        <select name="image_input" id="image_input" class="form-select">
                            <option value="">All</option>
                            <option value="true" {% if current_filters.image_input == true %}selected{% endif %}>Yes</option>
                            <option value="false" {% if current_filters.image_input == false %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'task_group' in enabled_filters %}
                    <!-- Task Group Filter -->
                    <div class="col-md-3">
                        <label for="task_group" class="form-label">Task Group</label>
                        <select name="task_group" id="task_group" class="form-select">
                            <option value="">All Task Groups</option>
                            {% for group in task_groups %}
                                <option value="{{ group }}" {% if current_filters.task_group == group %}selected{% endif %}>
                                    {{ group|title }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'language' in enabled_filters %}
                    <!-- Language Filter -->
                    <div class="col-md-2">
                        <label for="language" class="form-label">Language</label>
                        <select name="language" id="language" class="form-select">
                            <option value="">All Languages</option>
                            <option value="en" {% if current_filters.language == 'en' %}selected{% endif %}>English</option>
                            <option value="hu" {% if current_filters.language == 'hu' %}selected{% endif %}>Hungarian</option>
                            <option value="de" {% if current_filters.language == 'de' %}selected{% endif %}>German</option>
                            <option value="fr" {% if current_filters.language == 'fr' %}selected{% endif %}>French</option>
                            <option value="es" {% if current_filters.language == 'es' %}selected{% endif %}>Spanish</option>
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'tag' in enabled_filters %}
                    <!-- Tag Filter -->
                    <div class="col-md-3">
                        <label for="tag" class="form-label">Tag</label>
                        <select name="tag" id="tag" class="form-select">
                            <option value="">All Tags</option>
                            <option value="instruction" {% if current_filters.tag == 'instruction' %}selected{% endif %}>Instruction</option>
                            <option value="reasoning" {% if current_filters.tag == 'reasoning' %}selected{% endif %}>Reasoning</option>
                            <option value="general" {% if current_filters.tag == 'general' %}selected{% endif %}>General</option>
                            <option value="coding" {% if current_filters.tag == 'coding' %}selected{% endif %}>Coding</option>
                            <option value="multimodal" {% if current_filters.tag == 'multimodal' %}selected{% endif %}>Multimodal</option>
                        </select>
                    </div>
                    {% endif %}
                    
                    {% if 'parameters' in enabled_filters %}
                    <!-- Parameters Range -->
                    <div class="col-md-3">
                        <label class="form-label">Parameters (B)</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" name="parameters_min" class="form-control" 
                                       placeholder="Min" value="{{ current_filters.parameters_min or '' }}" step="0.1">
                            </div>
                            <div class="col-6">
                                <input type="number" name="parameters_max" class="form-control" 
                                       placeholder="Max" value="{{ current_filters.parameters_max or '' }}" step="0.1">
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if 'context_window' in enabled_filters %}
                    <!-- Context Window Range -->
                    <div class="col-md-3">
                        <label class="form-label">Context Window</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" name="context_min" class="form-control" 
                                       placeholder="Min" value="{{ current_filters.context_min or '' }}">
                            </div>
                            <div class="col-6">
                                <input type="number" name="context_max" class="form-control" 
                                       placeholder="Max" value="{{ current_filters.context_max or '' }}">
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if 'release_date' in enabled_filters %}
                    <!-- Release Date Range -->
                    <div class="col-md-3">
                        <label class="form-label">Release Date</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="date" name="release_after" class="form-control" 
                                       value="{{ current_filters.release_after or '' }}">
                            </div>
                            <div class="col-6">
                                <input type="date" name="release_before" class="form-control" 
                                       value="{{ current_filters.release_before or '' }}">
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Apply/Clear Buttons -->
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-filter"></i> Apply
                        </button>
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i> Clear
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Leaderboard Table -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        {% for col_key in enabled_columns %}
                            {% set col_info = visible_columns[col_key] %}
                            <th>{{ col_info.label }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for model in leaderboard %}
                    <tr>
                        {% set outer_loop = loop %}
                        {% for col_key in enabled_columns %}
                            {% if col_key == 'rank' %}
                                <td>{{ outer_loop.index }}</td>
                            {% elif col_key == 'model' %}
                                <td>
                                    <strong>{{ model.name }}</strong>
                                </td>
                            {% elif col_key == 'tags' %}
                                <td>
                                    {% if model.meta.tags %}
                                        {% for tag in model.meta.tags %}
                                            <span class="badge bg-secondary metric-badge">{{ tag }}</span>
                                        {% endfor %}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'provider' %}
                                <td>{{ model.meta.get('provider', 'Unknown') }}</td>
                            {% elif col_key == 'open_source' %}
                                <td>
                                    {% if model.meta.open_source %}
                                        <span class="badge bg-success">Yes</span>
                                    {% else %}
                                        <span class="badge bg-warning">No</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'tasks' %}
                                <td>{{ model.task_count or 0 }}</td>
                            {% elif col_key == 'avg_tokens' %}
                                <td>{{ "%.0f"|format(model.avg_tokens) if model.avg_tokens else 'N/A' }}</td>
                            {% elif col_key == 'quality_score' %}
                                <td>
                                    {% if model.avg_quality_score is not none %}
                                        <span class="badge bg-success">{{ "%.1f"|format(model.avg_quality_score) }}/10</span>
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'rouge_l' %}
                                <td>
                                    {% if model.avg_rouge_l is not none %}
                                        <span class="badge bg-info">{{ "%.3f"|format(model.avg_rouge_l) }}</span>
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'bert_score' %}
                                <td>
                                    {% if model.avg_bert_score is not none %}
                                        <span class="badge bg-success">{{ "%.3f"|format(model.avg_bert_score) }}</span>
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'reasoning' %}
                                <td>
                                    {% if model.meta.get('reasoning') %}
                                        <span class="badge bg-success">Yes</span>
                                    {% else %}
                                        <span class="badge bg-warning">No</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'parameters' %}
                                <td>
                                    {% if model.meta.get('parameters') %}
                                        {{ model.meta.parameters }}B
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'context_window' %}
                                <td>
                                    {% if model.meta.get('context_window') %}
                                        {{ "{:,}".format(model.meta.context_window) }}K
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'image_input' %}
                                <td>
                                    {% if model.meta.get('image_input') %}
                                        <span class="badge bg-success">Yes</span>
                                    {% else %}
                                        <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'release_date' %}
                                <td>
                                    {% if model.meta.get('release_date') %}
                                        {{ model.meta.release_date }}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            {% elif col_key == 'actions' %}
                                <td>
                                    <a href="{{ url_for('model_detail', model_key=model.model_key) }}" 
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i> Details
                                    </a>
                                    <a href="{{ url_for('side_by_side') }}?models={{ model.model_key }}" 
                                       class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-columns"></i> Compare
                                    </a>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="{{ enabled_columns|length }}" class="text-center text-muted">
                            <i class="fas fa-inbox"></i> No models found matching the current filters.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if leaderboard %}
        <div class="row mt-4">
            <div class="col-md-12">
                <p class="text-muted text-center">
                    Showing {{ leaderboard|length }} models
                    {% if current_filters %}
                        with active filters
                        <a href="{{ url_for('index') }}" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-times"></i> Clear Filters
                        </a>
                    {% endif %}
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}